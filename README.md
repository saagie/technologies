# Saagie Technologies

[![GitHub release](https://img.shields.io/github/release/saagie/technologies?style=for-the-badge)][releases] 
[![GitHub release date](https://img.shields.io/github/release-date/saagie/technologies?style=for-the-badge&color=blue)][releases]  

[![Build Promote](https://img.shields.io/github/workflow/status/saagie/technologies/PROMOTE?label=LATEST%20PROMOTE&style=for-the-badge)][build_promote] [![Build modify](https://img.shields.io/github/workflow/status/saagie/technologies/BUILD%20ONLY%20MODIFIED?label=LATEST%20BRANCH%20BUILD&style=for-the-badge)][build_modified]

[![Issues](https://img.shields.io/github/issues-raw/saagie/technologies?style=for-the-badge&color=blue)][issues]

[![License](https://img.shields.io/github/license/saagie/technologies?style=for-the-badge&color=blue)][license]

[![Contributors](https://img.shields.io/github/contributors/saagie/technologies?style=for-the-badge&color=blue)][contributors]

[releases]: https://github.com/saagie/technologies/releases
[contributors]: https://github.com/saagie/technologies/graphs/contributors
[issues]: https://github.com/saagie/technologies/issues
[license]: https://github.com/saagie/technologies/blob/master/LICENSE
[build_promote]: https://github.com/saagie/technologies/actions?query=workflow%3APROMOTE
[build_modified]: https://github.com/saagie/technologies/actions?query=workflow%3A%22BUILD+ONLY+MODIFIED%22

This repository contains all the certified technologies used in Saagie.
It also includes some technologies that are still in the experimental phase.

For more information on how to use these technologies with your Saagie platform, see the <a href="https://docs.saagie.io/user/latest/developer/sdk/" target="_blank">official Saagie documentation</a>.

## How to contribute to this repository?

All contributions are made with Github pull requests.

## About the build

The build uses <a href="https://gradle.org/" target="_blank">Gradle</a>. 

Launch the Gradle task `localBuildModifiedJobs` or `localBuildModifiedApps` to build the modified technology locally:

    ./gradlew localBuildModifiedJobs
    ./gradlew localBuildModifiedApps

### Continuous Integration (CI)

The build is executed using a Github Action workflow called <a href="https://github.com/saagie/technologies/blob/a32ff207775fb3c53bb3874e384b7b90323e78e5/.github/workflows/buildOnlyModified.yml" target="_blank">`BUILD ONLY MODIFIED`</a>. It builds only the modified technologies and generates a pre-release containing the assets. The name of the pre-release is `the current version + the branch name`.

### Structure

The build is based on our <a href="https://github.com/saagie/technologies-plugin" target="_blank">Gradle plugin for the Saagie technology repository</a>. It expects to see a specific directory structure, which includes:

- The `technologies` directory: This is the base directory required. It contains subdirectories for each type of technology metadata.
  - The `app` subdirectory: It contains folders for each app technology.
  - The `job` subdirectory: It contains folders for each job technology.
  - The `connectiontype` subdirectory: It contains folders for each connection type.
  - The `scripts` subdirectory: It is dedicated to external technologies that share the same JavaScript files.
- A `metadata.yaml` file for each metadata folder. For `job` and `app` technology metadata, the build automatically generates them from the `technology.yaml` file and from each `context.yaml` found in the subfolders.

> [!NOTE]
> Generated files, such as `metadata.yaml`, `.js` files, and others, must be checked in Git, as the build tries to avoid rebuilding technologies that have not been modified.

#### Docker-based technologies

> [!NOTE] 
> These technologies are not external. They are based on a Docker image and embedded in Saagie.

For each job or app technology context, there must be a context-specific folder that includes:
- A `build.gradle.kts` file, which is mandatory. It applies the `SaagieTechnologiesGradlePlugin` and the `DockerRemoteApiPlugin` Gradle tasks. 
- A `Dockerfile` file, which is mandatory. It declares how to build the Docker image.
- A `image_test.yml` file, which is optional. If present, the generated Docker image will be tested with the <a href="https://github.com/GoogleContainerTools/container-structure-test" target="_blank">GoogleContainerTools/container-structure-test</a> project.

#### External technologies

> [!NOTE] 
> These technologies are external. They are not part of Saagie.

Each context of an external job technology has its dedicated `context.yaml` file, in which JavaScript files are referenced. The JavaScript files can be placed anywhere in the directory structure, as long as the relative path is proprely filled in the `context.yaml` file. These referenced `.js` files must be generated by a dedicated JavaScript build.

Saagie’s Gradle plugin can be used to trigger the build of these JavaScript files in the CI. For that, your external technology context folder must include:
- A `build.gradle.kts` file, which is mandatory. It applies the `SaagieTechnologiesGradlePlugin` and the `NodePlugin` Gradle tasks.
- A `package.json` file, which is mandatory. This file includes a `build` script and a `test` script.

Saagie’s Gradle plugin will launch <a href="https://yarnpkg.com/" target="_blank">Yarn</a> to install dependencies and run the scripts to build and test JavaScript files.

#### Build an external job technology

> [!IMPORTANT] 
> We strongly recommend that you use the <a href="https://github.com/saagie/sdk" target="_blank">Saagie SDK</a> repository to develop your external job technologies. The Saagie SDK will help you to create your own technologies and integrate them into your Saagie platform. For more information, see our documentation on <a href="https://docs.saagie.io/user/latest/developer/sdk/" target="_blank"> Saagie SDK</a>.

For technologies that do not share the same scripts with other technologies, it should already be setup. 
<br>For example, in the <a href="https://github.com/saagie/technologies/tree/master/technologies/job/dataiku" target="_blank">`dataiku` folder</a>, run `yarn dev` to build the JavaScript files with the watch mode and start the SDK webapp.
> [!NOTE] 
> What is _watch mode_? 
> <br>After the task is completed, the tool enters a loop where it watches the file system for changes to your source files. Whenever a change is detected, the task runs again to update its output.

For technologies that share `.js` scripts with other technologies, such as `aws`, `gcp`, or `azure`, the setup is split into two parts. 
1. In the folder dedicated to the shared scripts, run `yarn dev` to execute the build with the watch mode. 
2. In the folder dedicated to the technology to be developed, such as `aws-lambda`, run `npx @saagie/sdk start` to start the SDK webapp.

### Promotion

When the pull-request is merged into `master`, another GitHub action starts. This action will run a Gradle task to re-tag the Docker images with the branch name to a “production” name. It will then generate a real release, deleting the pre-release.
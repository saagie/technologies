version: v1
id: azure-machine-learning
label: Azure Machine Learning
description: ""
available: false
type: EXTERNAL_JOB
icon: job

contexts:
  - id: automated-ml
    label: Automated ML
    description: "Azure ML automated ML runs"
    recommended: false
    trustLevel: experimental
    available: true
    connectionTypeId: azure
    parameters:
      - type: DYNAMIC_SELECT
        id: resourceGroup
        label: Resource Group
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getResourceGroups
      - type: DYNAMIC_SELECT
        id: workspace
        label: Workspace
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getWorkspaces
        dependsOn:
          - resourceGroup
      - type: DYNAMIC_SELECT
        id: experiment
        label: Experiment
        comment: Experiment for new run.
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getExperiments
        dependsOn:
          - workspace
      - type: DYNAMIC_SELECT
        id: compute
        label: Compute cluster
        comment: A training cluster is required to execute the run in Azure.
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getComputes
        dependsOn:
          - workspace
      - type: DYNAMIC_SELECT
        id: dataset
        label: Dataset
        comment: Dataset for new run.
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getDatasets
        dependsOn:
          - workspace
      - type: DYNAMIC_SELECT
        id: targetColumn
        label: Target column
        comment: This is what the model will be trained to predict.
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getDatasetColumns
        dependsOn:
          - dataset
      - type: STATIC_SELECT
        id: taskType
        label: Task type
        mandatory: true
        staticValues:
          - id: classification
            label: Classification
          - id: regression
            label: Regression
          - id: time-series-forecasting
            label: Time series forecasting
        dependsOn:
          - dataset
      - type: DYNAMIC_SELECT
        id: timeColumn
        label: Time column
        comment: The column which holds the timestamp for time series data. Only required for Time series forecasting task type.
        mandatory: false
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getDatasetColumns
        dependsOn:
          - taskType
    actions:
      start:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: startAutomatedML
      stop:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: stopAutomatedML
      getStatus:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: getStatus
      getLogs:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: getLogs
  - id: experiments
    label: Experiments runs
    description: "Azure ML experiments runs"
    recommended: false
    trustLevel: experimental
    available: true
    connectionTypeId: azure
    parameters:
      - type: DYNAMIC_SELECT
        id: resourceGroup
        label: Resource Group
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getResourceGroups
      - type: DYNAMIC_SELECT
        id: workspace
        label: Workspace
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getWorkspaces
        dependsOn:
          - resourceGroup
      - type: DYNAMIC_SELECT
        id: experiment
        label: Experiment
        comment: Experiment for new run
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getExperiments
        dependsOn:
          - workspace
      - type: TEXT
        id: projectZipFile
        label: Project Zip file
        comment: Project Zip file content in base 64
        mandatory: true
        dependsOn:
          - workspace
      - type: TEXT
        id: runDefinitionFile
        label: Run definition file
        comment: Run definition file JSON content in base 64
        mandatory: true
        dependsOn:
          - workspace
    actions:
      start:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: startExperiment
      stop:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: stopExperiment
      getStatus:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: getStatus
      getLogs:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: getLogs
  - id: pipelines
    label: Pipelines
    description: "Azure ML pipelines"
    recommended: false
    trustLevel: experimental
    available: true
    connectionTypeId: azure
    parameters:
      - type: DYNAMIC_SELECT
        id: resourceGroup
        label: Resource Group
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getResourceGroups
      - type: DYNAMIC_SELECT
        id: workspace
        label: Workspace
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getWorkspaces
        dependsOn:
          - resourceGroup
      - type: DYNAMIC_SELECT
        id: pipelineRun
        label: Pipelines runs
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getMLPipelinesRuns
        dependsOn:
          - workspace
      - type: DYNAMIC_SELECT
        id: targetExperiment
        label: New run experiment
        comment: Target experiment for new run of pipeline run
        mandatory: true
        dynamicValues:
          script: .//../../scripts/azure/dist/job-form.js
          function: getExperiments
        dependsOn:
          - pipelineRun
      - type: TEXT
        id: description
        label: New run description
        comment: Description for new run of pipeline run
        mandatory: true
        dependsOn:
          - pipelineRun
      - type: TEXT
        id: parameters
        label: New run parameters
        comment: JSON containing run parameters
        mandatory: false
        dependsOn:
          - pipelineRun
    actions:
      start:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: startPipeline
      stop:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: stopPipeline
      getStatus:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: getStatus
      getLogs:
        script: .//../../scripts/azure/dist/machine-learning-actions.js
        function: getLogs
